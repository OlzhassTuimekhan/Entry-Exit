<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>People Counter - –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–Ω–∏–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border: 2px dashed #ddd;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .video-container {
            position: relative;
            margin: 20px 0;
            display: none;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        #videoPlayer {
            width: 100%;
            height: auto;
            display: block;
        }

        .canvas-overlay {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            pointer-events: none;
        }

        .canvas-overlay.drawing {
            pointer-events: all;
        }

        .controls {
            display: none;
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .control-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .line-info {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .line-coords {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
            color: #495057;
        }

        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions ol {
            color: #856404;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .command-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ People Counter</h1>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ –∏ –Ω–∞—Ä–∏—Å—É–π—Ç–µ –ª–∏–Ω–∏—é –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –ª—é–¥–µ–π</p>
        </div>

        <div class="upload-section">
            <h3>üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</h3>
            <p style="margin: 15px 0; color: #666;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP4, AVI, MOV, MKV</p>
            <input type="file" id="videoInput" accept="video/*" style="display: none;">
            <button class="upload-btn" onclick="document.getElementById('videoInput').click()">
                –í—ã–±—Ä–∞—Ç—å –≤–∏–¥–µ–æ —Ñ–∞–π–ª
            </button>
        </div>

        <div class="video-container" id="videoContainer">
            <video id="videoPlayer" controls>
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
            </video>
            <canvas id="lineCanvas" class="canvas-overlay"></canvas>
        </div>

        <div class="controls" id="controls">
            <div class="instructions">
                <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h3>
                <ol>
                    <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é"</li>
                    <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É –ª–∏–Ω–∏–∏</li>
                    <li>–ö–ª–∏–∫–Ω–∏—Ç–µ –µ—â–µ —Ä–∞–∑, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É</li>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ</li>
                </ol>
            </div>

            <div class="control-group">
                <label>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–Ω–∏–∏ –ø–æ–¥—Å—á–µ—Ç–∞</label>
                <div class="control-row">
                    <button class="btn btn-primary" id="drawLineBtn">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é</button>
                    <button class="btn btn-secondary" id="clearLineBtn">–û—á–∏—Å—Ç–∏—Ç—å –ª–∏–Ω–∏—é</button>
                    <button class="btn btn-danger" id="resetBtn">–°–±—Ä–æ—Å</button>
                </div>
            </div>

            <div class="line-info" id="lineInfo" style="display: none;">
                <h4>üìè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–Ω–∏–∏:</h4>
                <div class="line-coords" id="lineCoords">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –∑–¥–µ—Å—å</div>
                <p><strong>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</strong> LEFT ‚Üí RIGHT = –í–•–û–î, RIGHT ‚Üí LEFT = –í–´–•–û–î</p>
            </div>

            <div class="control-group">
                <label>‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</label>
                <div class="control-row">
                    <label>
                        <input type="checkbox" id="saveVideo" checked> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    </label>
                    <label>
                        <input type="checkbox" id="showDisplay" checked> –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ
                    </label>
                </div>
            </div>

            <div class="control-group">
                <label>üñ•Ô∏è –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:</label>
                <div class="command-output" id="commandOutput">
                    –ù–∞—Ä–∏—Å—É–π—Ç–µ –ª–∏–Ω–∏—é, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É...
                </div>
            </div>
        </div>

        <div class="file-info" id="fileInfo" style="display: none;">
            <h4>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</h4>
            <p id="fileName"></p>
            <p id="fileSize"></p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
    </div>

    <script>
        let video = document.getElementById('videoPlayer');
        let canvas = document.getElementById('lineCanvas');
        let ctx = canvas.getContext('2d');
        let isDrawing = false;
        let startPoint = null;
        let endPoint = null;
        let currentVideoFile = null;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
        document.getElementById('videoInput').addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                currentVideoFile = file;
                let url = URL.createObjectURL(file);
                video.src = url;

                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                document.getElementById('fileName').textContent = `–ò–º—è: ${file.name}`;
                document.getElementById('fileSize').textContent = `–†–∞–∑–º–µ—Ä: ${(file.size / 1024 / 1024).toFixed(2)} –ú–ë`;
                document.getElementById('fileInfo').style.display = 'block';

                // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≤–∏–¥–µ–æ
                document.getElementById('videoContainer').style.display = 'block';
                document.getElementById('controls').style.display = 'block';

                // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                let progress = 0;
                let progressBar = document.getElementById('progressFill');
                let interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                    }
                    progressBar.style.width = progress + '%';
                }, 100);
            }
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–µ–æ
        video.addEventListener('loadedmetadata', function() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ canvas –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –≤–∏–¥–µ–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            let rect = video.getBoundingClientRect();
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ canvas –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', function() {
            if (video.videoWidth && video.videoHeight) {
                let rect = video.getBoundingClientRect();
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';
            }
        });

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é"
        document.getElementById('drawLineBtn').addEventListener('click', function() {
            isDrawing = true;
            startPoint = null;
            endPoint = null;
            canvas.classList.add('drawing');
            clearLine();
            this.textContent = '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –≤–∏–¥–µ–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ—á–µ–∫';
            this.style.background = '#28a745';
        });

        // –ö–Ω–æ–ø–∫–∞ "–û—á–∏—Å—Ç–∏—Ç—å –ª–∏–Ω–∏—é"
        document.getElementById('clearLineBtn').addEventListener('click', function() {
            clearLine();
            isDrawing = false;
            canvas.classList.remove('drawing');
            document.getElementById('drawLineBtn').textContent = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é';
            document.getElementById('drawLineBtn').style.background = '';
            document.getElementById('lineInfo').style.display = 'none';
            updateCommand();
        });

        // –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å"
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
                location.reload();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –Ω–∞ canvas
        canvas.addEventListener('click', function(e) {
            if (!isDrawing) return;

            let rect = canvas.getBoundingClientRect();
            let scaleX = canvas.width / rect.width;
            let scaleY = canvas.height / rect.height;

            let x = (e.clientX - rect.left) * scaleX;
            let y = (e.clientY - rect.top) * scaleY;

            if (!startPoint) {
                startPoint = {x: x, y: y};
                drawPoint(x, y, '#00ff00', '–ù–ê–ß–ê–õ–û');
            } else if (!endPoint) {
                endPoint = {x: x, y: y};
                drawPoint(x, y, '#ff0000', '–ö–û–ù–ï–¶');
                drawLine();
                isDrawing = false;
                canvas.classList.remove('drawing');
                document.getElementById('drawLineBtn').textContent = '–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏—é';
                document.getElementById('drawLineBtn').style.background = '';
                showLineInfo();
                updateCommand();
            }
        });

        function drawPoint(x, y, color, label) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, 2 * Math.PI);
            ctx.fill();

            // –ü–æ–¥–ø–∏—Å—å —Ç–æ—á–∫–∏
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(label, x, y - 15);
        }

        function drawLine() {
            if (!startPoint || !endPoint) return;

            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(startPoint.x, startPoint.y);
            ctx.lineTo(endPoint.x, endPoint.y);
            ctx.stroke();

            // –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            let angle = Math.atan2(endPoint.y - startPoint.y, endPoint.x - startPoint.x);
            let midX = (startPoint.x + endPoint.x) / 2;
            let midY = (startPoint.y + endPoint.y) / 2;

            // –†–∏—Å—É–µ–º —Å—Ç—Ä–µ–ª–∫—É
            ctx.save();
            ctx.translate(midX, midY);
            ctx.rotate(angle);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(-15, -8);
            ctx.lineTo(-15, 8);
            ctx.closePath();
            ctx.fillStyle = '#ffff00';
            ctx.fill();
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();
        }

        function clearLine() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function showLineInfo() {
            if (!startPoint || !endPoint || !video.videoWidth || !video.videoHeight) return;

            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (0-1)
            let x1 = startPoint.x / video.videoWidth;
            let y1 = startPoint.y / video.videoHeight;
            let x2 = endPoint.x / video.videoWidth;
            let y2 = endPoint.y / video.videoHeight;

            let coords = `${x1.toFixed(3)},${y1.toFixed(3)},${x2.toFixed(3)},${y2.toFixed(3)}`;

            document.getElementById('lineCoords').textContent = coords;
            document.getElementById('lineInfo').style.display = 'block';
        }

        function updateCommand() {
            if (!currentVideoFile || !startPoint || !endPoint) {
                document.getElementById('commandOutput').textContent = '–ù–∞—Ä–∏—Å—É–π—Ç–µ –ª–∏–Ω–∏—é, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É...';
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            let x1 = startPoint.x / video.videoWidth;
            let y1 = startPoint.y / video.videoHeight;
            let x2 = endPoint.x / video.videoWidth;
            let y2 = endPoint.y / video.videoHeight;

            let lineCoords = `${x1.toFixed(3)},${y1.toFixed(3)},${x2.toFixed(3)},${y2.toFixed(3)}`;
            let videoPath = currentVideoFile.name;

            let saveFlag = document.getElementById('saveVideo').checked ? ' --save' : '';
            let displayFlag = document.getElementById('showDisplay').checked ? ' --display' : '';

            let command = `python main.py --source "videos/${videoPath}" --line ${lineCoords}${saveFlag}${displayFlag}`;

            document.getElementById('commandOutput').textContent =
                `# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:\n\n${command}\n\n# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∏–¥–µ–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ —Å–∫—Ä–∏–ø—Ç\n# –ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –≤–∏–¥–µ–æ —Ñ–∞–π–ª—É`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–µ–∫–±–æ–∫—Å–æ–≤
        document.getElementById('saveVideo').addEventListener('change', updateCommand);
        document.getElementById('showDisplay').addEventListener('change', updateCommand);
    </script>
</body>
</html>